var base = location.protocol + '//' + location.host;

$(document).ready(function () {
    $('.add-to-cart').on("submit", function (e) {
        e.preventDefault();

        var $form = $(this);
        var $button = $form.find("[type='submit']");

        $.ajax({

            url: $form.attr("action"),
            method: $form.attr("method"),
            data: $form.serialize(),
            dataType: "JSON",
            beforeSend: function () {
                $button.html('<div class="preloader-wrapper small active" style="zoom: 70%; margin-top: 10px;"><div class="spinner-layer spinner-blue-only" style="border-color: white;"><div class="circle-clipper left" ><div class="circle"></div></div><div class="gap-patch" ><div class="circle" ></div></div><div class="circle-clipper right" ><div class="circle"></div></div></div></div>');
            },
            success: function (data) {
                $button.html('<i class="mdi-action-done"></i>');
                $(".carrito-red").html(data.products_count);
                Materialize.toast('<i class="'+data.icon+'" style="margin-right: 5px;"></i> <h6 class="'+data.type+'">'+data.message+'</h6>', 4000);
                setTimeout(() => {
                    rb($button);
                }, 1000);
            },
            error: function (err) {
                $button.html('<i class="mdi-alert-error"></i>');
                Materialize.toast('<i class="mdi-alert-error red-text" style="margin-right: 5px;"></i> <h6 class="red-text">Upss, Algo salio mal...</h6>', 4000);
                setTimeout(() => {
                    rb($button);
                }, 1000);
            }

        });
        return false;
    });

    function rb($button) {
        $button.html('<i class="mdi-action-shopping-cart"></i>');
    }

    $('.in_car').on("click", function (e) {
        e.preventDefault();

        var $button = $(this);

        $.ajax({

            url: $button.attr("href"),
            method: "GET",
            beforeSend: function () {
                $button.html('<div class="preloader-wrapper small active" style="zoom: 70%; margin-top: 10px;"><div class="spinner-layer spinner-blue-only" style="border-color: white;"><div class="circle-clipper left" ><div class="circle"></div></div><div class="gap-patch" ><div class="circle" ></div></div><div class="circle-clipper right" ><div class="circle"></div></div></div></div>');
            },
            success: function (data) {
                $button.html('<i class="mdi-action-done"></i>');
                $(".carrito-red").html(data.products_count);
                $(".cant").html(data.products_count);

                if (data.price) {
                    $(".product-"+data.id.card_id+" .inventario").html(data.id.inventario);
                    $(".product-"+data.id.card_id+" .total").html(data.id.inventario*data.price);
                } else {
                    $(".product-"+data.id.card_id).html('');
                }

                $(".totales").html(data.total);

                if (!data.total) {
                    $(".compra").html('<div class="col s12"><h5 class="red-text text-accent-3"><i class="mdi-action-shopping-cart small left"></i>Carrito Vacio</h5></div>');
                    $(".form-compra").html('');
                }

                Materialize.toast('<i class="'+data.icon+'" style="margin-right: 5px;"></i> <h6 class="'+data.type+'">'+data.message+'</h6>', 4000);
                setTimeout(() => {
                    rsb($button, data.message);
                }, 1000);
            },
            error: function (err) {
                $button.html('<i class="mdi-alert-error"></i>');
                Materialize.toast('<i class="mdi-alert-error red-text" style="margin-right: 5px;"></i> <h6 class="red-text">Upss, Algo salio mal...</h6>', 4000);
                setTimeout(() => {
                    rsb($button);
                }, 1000);
            }

        });
        return false;
    });

    function rsb($button, message) {
        if (message[9]=='A') {
            $button.html('<i class="mdi-image-exposure-plus-1"></i>');
        } else {
            $button.html('<i class="mdi-image-exposure-minus-1"></i>');
        }
        
    }

    $('.box-public').on("change", function (e) {

        var $button = $(this);

        var id = $button.attr("id");

        if ($button.attr("checked") == "checked") {
            var $url = base+"/admin/cards/eraser/"+id;
        } else {
            var $url = base+"/admin/cards/public/"+id;
        }

        $.ajax({
            
            url: $url,
            method: "GET",
            beforeSend: function () {
            },
            success: function (data) {
                Materialize.toast('<i class="'+data.icon+'" style="margin-right: 5px;"></i> <h6 class="'+data.type+'">'+data.message+'</h6>', 4000);
                $('.field-public-'+id).css('background-color', data.color);
            },
            error: function (err) {
                Materialize.toast('<i class="mdi-alert-error red-text" style="margin-right: 5px;"></i> <h6 class="red-text">Upss, Algo salio mal...</h6>', 4000);
            }

        });
        return false;
    });

});

function setClipboardCard(){
    var id = "referir";
    var existsTextarea = document.getElementById(id);

    existsTextarea.select();
    
    document.execCommand('copy');

    Materialize.toast('<i class="mdi-content-content-copy green-text" style="margin-right: 5px;"></i> <h6 class="green-text">Enlace Copiado</h6>', 4000);

}

// function alerta(meessage, tipo) {
    
   
// }